function t(t){if("string"!=typeof t&&"symbol"!=typeof t)throw new TypeError(" EVENTNAME expected: string | symbol;but invalid :"+t)}function e(t){if("function"!=typeof t)throw new TypeError(" EVENTLISTENER expected: (event?: any) => void;but invalid:"+t)}const n="EventEmitterTarget";function r(){return{}.toString.call({[Symbol.toStringTag]:n})}export default function o(i){const u=function(o){if(!("number"==typeof o&&o>0&&1/0>o))throw TypeError(" MAX expected: number;but invalid:"+o);const i=o,u=new Map,s=t=>{const e=u.get(t);if(e)return e;{const e=Symbol(t);return u.set(t,e),e}};let c=0,f=0;const l=function o(){const i=function(){const o=new Map,i=new WeakMap;function u(t){let e=o.get(t);return e||(e=new Set,o.set(t,e)),e}function s(e){t(e),o.has(e)&&u(e).clear()}function c(e,n){t(e),o.has(e)&&u(e).forEach(t=>{Promise.resolve().then(()=>{t(n)})})}function f(n,r){t(n),e(r),u(n).add(r)}function l(t,e){u(t).delete(e)}function a(n,r){t(n),e(r),l(n,r),function(t,e){const n=u(t);let r=i.get(e);r&&n.delete(r)}(n,r)}function m(){return[...o].map(([t,e])=>[t,[...e]])[Symbol.iterator]()}return{[Symbol.toPrimitive]:r,[Symbol.toStringTag]:n,[Symbol.iterator]:m,entries:m,listenerCount:function(e){return t(e),o.has(e)?u(e).size:0},clear:s,removeAllListeners:s,on:f,addListener:f,off:a,removeListener:a,once:function(n,r){t(n),e(r);let o=!1,u=i.get(r);if(!u){const t=e=>{l(n,t),l(n,r),o||(o=!0,r(e))};u=t,i.set(r,u)}l(n,r),f(n,u)},emit:c,dispatch:c,eventNames:function(){return[...o.keys()]},listeners:function(e){return t(e),o.has(e)?[...u(e)]:[]}}}();return this&&this instanceof o?(Object.assign(this,i),this):i}(),a=[];let m=!0;function h(){const t=c;if(!m)return;if(t>=a.length)return void(m=!1);if("full"===g())return void(m=!1);!function(){if(!(f<i))throw Error();f++,y()}();const e=a[t];if(!e)throw Error();const[n,r]=e,o=Promise.resolve(Reflect.apply(n,void 0,r)),u=()=>{l.emit(s("settle"+t),o),function(){if(f-1<0)throw Error();f--,y()}(),a[t]=void 0};o.then(u,u),c++,Promise.resolve().then(()=>{h()})}function g(){return f<i?"free":"full"}l.on("free",()=>{m=!0,h()}),l.on("full",()=>{m=!1});const p={asyncwrap:function(t){return async function(...e){return await function(t){let e=a.length;return a.push(t),"free"===g()&&(m=!0,h()),new Promise(t=>{l.once(s("settle"+e),e=>{t(e)})})}([t,e])}},status:g,limiter:{get max(){return i},get current(){return f}},queue:{get max(){return a.length},get current(){return c}},target:l};function y(){const{queue:t,limiter:e}=p,n={status:g(),queue:{max:t.max,current:t.current},limiter:{max:e.max,current:e.current}};f>=i?l.emit("full",n):l.emit("free",n)}return p}(i);return this&&this instanceof o?(Object.assign(this,u),this):u}
//# sourceMappingURL=index.js.map
