import e from"@masx200/event-emitter-target";function t(t){if(!("number"==typeof t&&t>0&&1/0>t))throw TypeError(" MAX expected: number;but invalid:"+t);const r=t,n=new Map;let o=0,u=0;const i=e(),s=[];let c=!0;function f(){const e=o;if(!c)return;if(e>=s.length)return void(c=!1);if("full"===a())return void(c=!1);!function(){if(!(u<r))throw Error();u++,h()}();const t=s[e];if(!t)throw Error();const[i,l]=t,m=Promise.resolve(Reflect.apply(i,void 0,l)),g=()=>{const t=n.get(e);if(!t)throw new Error;t.resolve(m),function(){if(u-1<0)throw Error();u--,h()}(),s[e]=void 0,n.delete(e)};m.then(g,g),o++,Promise.resolve().then((()=>{f()}))}function l(e){let t=s.length;s.push(e),"free"===a()&&(c=!0,f());const r=function(){let e=e=>{},t=e=>{};return{promise:new Promise(((r,n)=>{e=r,t=n})),reject:t,resolve:e}}();return n.set(t,r),Promise.resolve(r.promise)}function a(){return u<r?"free":"full"}i.on("free",(()=>{c=!0,f()})),i.on("full",(()=>{c=!1}));const m={[Symbol.toStringTag]:"AsyncCurrentLimiter",asyncwrap:function(e){return async function(...t){return await l([e,t])}},status:a,limiter:{get max(){return r},get current(){return u}},queue:{get max(){return s.length},get current(){return o}},target:i};function h(){const{queue:e,limiter:t}=m,n={status:a(),queue:{max:e.max,current:e.current},limiter:{max:t.max,current:t.current}};u>=r?i.emit("full",n):i.emit("free",n)}return m}var r=(()=>{var e=new Function("return async()=>{}")()(),r=Symbol();function n(e){const r=t(e);return this&&this instanceof n?(Object.assign(this,r),this):Reflect.construct(n,[e])}return Reflect.set(n,r,e),n})();export{r as default};
//# sourceMappingURL=index.js.map
