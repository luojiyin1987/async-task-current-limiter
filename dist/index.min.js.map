{"version":3,"file":"index.min.js","sources":["index.js"],"sourcesContent":["import e from\"@masx200/event-emitter-target\";function t(t){if(!(\"number\"==typeof t&&t>0&&1/0>t))throw TypeError(\" MAX expected: number;but invalid:\"+t);const r=t,n=new Map;let o=0,u=0;const i=e(),s=[];let c=!0;function f(){const e=o;if(!c)return;if(e>=s.length)return void(c=!1);if(\"full\"===a())return void(c=!1);!function(){if(!(u<r))throw Error();u++,h()}();const t=s[e];if(!t)throw Error();const[i,l]=t,m=Promise.resolve(Reflect.apply(i,void 0,l)),g=()=>{const t=n.get(e);if(!t)throw new Error;t.resolve(m),function(){if(u-1<0)throw Error();u--,h()}(),s[e]=void 0,n.delete(e)};m.then(g,g),o++,Promise.resolve().then((()=>{f()}))}function l(e){let t=s.length;s.push(e),\"free\"===a()&&(c=!0,f());const r=function(){let e=e=>{},t=e=>{};return{promise:new Promise(((r,n)=>{e=r,t=n})),reject:t,resolve:e}}();return n.set(t,r),Promise.resolve(r.promise)}function a(){return u<r?\"free\":\"full\"}i.on(\"free\",(()=>{c=!0,f()})),i.on(\"full\",(()=>{c=!1}));const m={[Symbol.toStringTag]:\"AsyncCurrentLimiter\",asyncwrap:function(e){return async function(...t){return await l([e,t])}},status:a,limiter:{get max(){return r},get current(){return u}},queue:{get max(){return s.length},get current(){return o}},target:i};function h(){const{queue:e,limiter:t}=m,n={status:a(),queue:{max:e.max,current:e.current},limiter:{max:t.max,current:t.current}};u>=r?i.emit(\"full\",n):i.emit(\"free\",n)}return m}var r=(()=>{var e=new Function(\"return async()=>{}\")()(),r=Symbol();function n(e){const r=t(e);return this&&this instanceof n?(Object.assign(this,r),this):Reflect.construct(n,[e])}return Reflect.set(n,r,e),n})();export{r as default};\n//# sourceMappingURL=index.js.map\n"],"names":["createlimiter","max","Infinity","TypeError","r","cachepromise","Map","pointer","u","target","createeventtarget","queue","shouldrun","next","index","length","status","Error","dispatchstatus","funargs","fun","args","promise","Promise","resolve","Reflect","apply","settle","defer","get","delete","then","add","push","set","on","c","m","Symbol","toStringTag","asyncwrap","async","a","limiter","current","data","emit"],"mappings":"6CAeM,SAAUA,EAAcC,GAC1B,KAAqB,iBAARA,GAAoBA,EAAM,GAAKC,EAAAA,EAAWD,GACnD,MAAME,UAAU,qCAAuCF,GAE3D,MAAMG,EAAaH,EACbI,EAAe,IAAIC,IAazB,IAAIC,EAAU,EACVC,EAAa,EACjB,MAAMC,EAA6BC,IAC7BC,EAA8C,GACpD,IAAIC,KAQJ,SAASC,IACL,MAAMC,EAAQP,EACd,IAAKK,EACD,OAEJ,GAAIE,GAASH,EAAMI,OAEf,YADAH,MAGJ,GAAiB,SAAbI,IAEA,YADAJ,OAuGR,WACI,KAAIJ,EAAaJ,GAIb,MAAMa,QAHNT,IACAU,IAHR,GAnGUC,MAAAA,EAAUR,EAAMG,GACjBK,IAAAA,EACD,MAAMF,QAEV,MAAOG,EAAKC,GAAQF,EACdG,EAAUC,QAAQC,QAAQC,QAAQC,MAAMN,OAAAA,EAAgBC,IACxDM,EAAS,KAEX,MAAMC,EAAQvB,EAAawB,IAAIf,GAC/B,IAAIc,EAGA,MAAM,IAAIX,MAFJO,EAAAA,QAAQF,GAqE1B,WACI,GAAId,EAAa,EAAI,EACjB,MAAMS,QAEVT,IACAU,IALJ,GA/DQP,EAAMG,QAAAA,EACNT,EAAayB,OAAOhB,IAExBQ,EAAQS,KAAKJ,EAAQA,GACrBpB,IACAgB,QAAQC,UAAUO,MAAK,KACnBlB,OAGCmB,SAAAA,EACLb,GAEIL,IAAAA,EAAQH,EAAMI,OACZkB,EAAAA,KAAKd,GACM,SAAbH,MACAJ,GAAY,EACZC,KAEJ,MAAMe,uGAEN,OADAvB,EAAa6B,IAAIpB,EAAOc,GACjBL,QAAQC,QAAQI,EAAMN,SAUjC,SAASN,IACL,OAAOR,EAAaJ,EAAa,OAAS,OApEvC+B,EAAAA,GAAG,QAAQ,KACFC,GAAA,EACZvB,OAEJJ,EAAO0B,GAAG,QAAQ,KACdvB,GAAAA,KAiEJ,MAOMyB,EAAS,CACVC,CAAAA,OAAOC,aAAc,sBARRC,UAAA,SACdpB,GAEA,OAAOqB,iBAAmBpB,IAAAA,IAAAA,EAAAA,UAAAA,OAAAA,EAAAA,IAAAA,MAAAA,GAAAA,EAAAA,EAAAA,EAAAA,EAAAA,IAAAA,EAAAA,GAAAA,UAAAA,GACtB,aAAaW,EAAI,CAACZ,EAAKC,MAGhBL,OAAA0B,EAKFC,QAAA,CACD1C,UACA,OAAOG,GAEPwC,cACA,OAAOpC,IAGRG,MAAA,CACCV,UACA,OAAOU,EAAMI,QAEb6B,cACA,OAAOrC,IAGfE,OAAAA,GASJ,SAASS,IACL,MAAMP,MAAEA,EAAOgC,QAAAA,GAAYN,EACrBQ,EAAO,CACT7B,OAAQA,IACDL,MAAA,CAAEV,IAAKU,EAAMV,IAAK2C,QAASjC,EAAMiC,SAC/BD,QAAA,CAAE1C,IAAK0C,EAAQ1C,IAAK2C,QAASD,EAAQC,UAE9CpC,GAAcJ,EACdK,EAAOqC,KAAK,OAAQD,GAEpBpC,EAAOqC,KAAK,OAAQD,GAW5B,OAAOR"}